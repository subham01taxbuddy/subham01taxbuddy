<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px',fullScreenBackdrop:true }"></ngx-loading>

<div class="main clearfix" style="padding-top: 0px;">
    <div class="card">
        <div class="card__row" >
            <div class="filter__col card__col-sm-3 card__col-xs-12">
                <mat-form-field appearance="outline" style="margin-top: 10px;">
                  <mat-label>Select Agent</mat-label>
                  <mat-select placeholder="Select Agent Id" [(ngModel)]="selectedAgent">
                      <mat-option *ngFor="let agent of agentList" [value]="agent.agentId">
                          {{agent.name}} <span style="font-weight: bold;">{{agent.serviceType}}</span>
                      </mat-option>
                  </mat-select>
                  <!-- <mat-error *ngIf="agent.hasError('required')">Select agent id</mat-error> -->
              </mat-form-field>
              </div>

              <div class="filter__col card__col-sm-2 card__col-xs-12">
                <a class="btn btn_stroke filter__add-link" (click)="searchByAgent()"><i
                    class="fa fa-search" aria-hidden="true" style="color: #2ed13b;"></i>&nbsp;Search</a>
              </div>

              <div class="filter__col card__col-sm-3 card__col-xs-12">
                <mat-form-field appearance="outline" style="margin-top: 10px;" *ngIf="showAllUser">
                  <mat-label>Mobile Number: </mat-label>
                    <input matInput  placeholder="Enter Mobile Number" [(ngModel)]="searchMobNo" maxlength="35"
                        oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57"  maxlength="10">
                 </mat-form-field>
              </div>

              <div class="filter__col card__col-sm-2 card__col-xs-12">
                <a *ngIf="showAllUser" class="btn btn_stroke filter__add-link" (click)="serchByMobNo()"><i
                    class="fa fa-search" aria-hidden="true" style="color: #2ed13b;"></i>&nbsp;Search</a>
              </div>


              <div class="filter__col card__col-sm-2 card__col-xs-12">
                 <button  class="btn" (click)="getAllCallerUser()">All Caller</button>
              </div>
        </div><br><br>

        <!-- <div *ngIf="showAllUser">
            <ag-grid-angular class="ag-theme-balham" [gridOptions]="allCallerGridOptions">   
            </ag-grid-angular>
        </div> -->

        <div *ngIf="showAllUser">
            <p class="head"><b>All Caller Agents</b></p>
            <table >
                <tr>
                    <th><b>Sme Id</b></th>
                    <th><b>Name</b></th>
                    <th><b>Mobile</b></th>
                    <th><b>Email</b></th>
                    <th><b>Service Type</b></th>
                    <th><b>Agent</b></th>
                </tr>
                <tr *ngIf="allCallerData.length === 0">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr *ngFor="let item of allCallerData; let i=index;">
                    <td>{{item.smeId}}</td>
                    <td>{{item.name}}</td>
                    <td>{{item.mobileNumber}}</td>
                    <td>{{item.email}}</td>
                    <td>{{item.serviceType}}</td>
                    <td>
                        {{getAgents(item.agentsName)}}
                    </td>
                </tr>
            </table>
        </div>

        <table *ngIf="!showAllUser">
            <tr>
                <th><b>Sme Id</b></th>
                <th><b>Name</b></th>
                <th><b>Mobile</b></th>
                <th><b>Email</b></th>
                <th><b>Service Type</b></th>
                <th colspan="2"><b>Action</b></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th><b>Add</b></th>
                <th><b>Remove</b></th>
            </tr>
            <tr *ngIf="callerData.length === 0">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr *ngFor="let item of callerData; let i=index;">
                <td>{{item.smeId}}</td>
                <td>{{item.name}}</td>
                <td>{{item.mobileNumber}}</td>
                <td>{{item.email}}</td>
                <td>{{item.serviceType}}</td>
                <td>
                    <input *ngIf="!item.isAdded" type="checkbox" [value]="item.isAdded" (change)="addCaller($event, item.userId)" />
                </td>
                <td>
                    <input *ngIf="item.isAdded" type="checkbox" [value]="item.isAdded" (change)="removeCaller($event, item.userId)" />
                </td>
            </tr>
        </table>
        <br><br>
        
        <button class="btn" style="float: right;" *ngIf="removeCallerList.length > 0" (click)="saveCaller('remove')">Remove Callers</button>&nbsp;&nbsp;
        <button class="btn" style="float: right;" *ngIf="selectedCallerList.length > 0" (click)="saveCaller('add')">Add Callers</button>
    </div>
</div>
