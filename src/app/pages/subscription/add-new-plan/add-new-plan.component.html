<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"></ngx-loading>

<div class="main clearfix" style="padding-top: 0px">
  <div class="card" style="margin-top: 50px;">
    <div class="card__row">
      <div class="card__col-lg-6">
        <mat-card style="height: 305px;">
          <b style="font-size: 18px;">User Added Plan: </b><br>
          <div class="card__row" style="margin-top: 75px;">

            <div class="card__col-lg-5">
              <span class="head">Plan Name:</span><br>
              <!-- <span class="head">Desciption:</span><br> -->
              <span class="head">Validation For Days:</span><br>
              <span class="head">Base Price:</span><br>
              <span class="head">cgst:</span><br>
              <span class="head">sgst:</span><br>
              <span class="head">igst:</span><br>
              <span class="head">Total Tax:</span><br>
              <span class="head">Total Amount:</span>
            </div>
            <div class="card__col-lg-7"
              *ngIf="this.utilService.isNonEmpty(userSubscription) && this.utilService.isNonEmpty(userSubscription.userSelectedPlan)">
              <span class="head">{{userSubscription.userSelectedPlan.name}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.validForDays}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.basePrice | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.cgst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.sgst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.igst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.totalTax | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.userSelectedPlan.totalAmount | currency:'INR'}}</span>
            </div>
          </div>
        </mat-card>
      </div>

      <div class="card__col-lg-6">
        <mat-card style="height: 305px;">
          <b style="font-size: 18px;">SME Selcted Plan: </b><br>
          <div class="card__row">
            <div class="card__col-lg-6">
              <mat-form-field appearance="outline">
                <mat-label>Select Plan</mat-label>
                <mat-select matInput placeholder="Select Plan" [(ngModel)]="smeSelectedPlanId"
                  (selectionChange)="applySmeSelctedPlan($event)" autocomplete="off">
                  <mat-option *ngFor="let plan of allPlans" [value]="plan.planId">
                    {{ plan.name }}
                  </mat-option>
                </mat-select>
                <mat-error>Select ITR type</mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="card__row">
            <div class="card__col-lg-5">
              <span class="head">Plan Name:</span><br>
              <!-- <span class="head">Desciption:</span><br> -->
              <span class="head">Validation For Days:</span><br>
              <span class="head">Base Price:</span><br>
              <span class="head">cgst:</span><br>
              <span class="head">sgst:</span><br>
              <span class="head">igst:</span><br>
              <span class="head">Total Tax:</span><br>
              <span class="head">Total Amount:</span>
            </div>
            <div class="card__col-lg-7"
              *ngIf="this.utilService.isNonEmpty(userSubscription) && this.utilService.isNonEmpty(userSubscription.smeSelectedPlan)">
              <span class="head">{{userSubscription.smeSelectedPlan.name}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.validForDays}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.basePrice | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.cgst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.sgst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.igst | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.totalTax | currency:'INR'}}</span><br>
              <span class="head">{{userSubscription.smeSelectedPlan.totalAmount | currency:'INR'}}</span>
            </div>
          </div>


        </mat-card>
      </div>
    </div>

    <div class="card__row">
      <div class="card__col-lg-6">
        <div class="promo">
          <b style="font-size: 18px;">Promo Code: </b><br>
          <div class="card__row">
            <div class="card__col-lg-6">
              <mat-form-field appearance="outline">
                <mat-label>Select Promo Code</mat-label>
                <mat-select matInput placeholder="Select Promo Code" [(ngModel)]="selectedPromoCode"
                  (selectionChange)="showPromoCode($event.value)" autocomplete="off">
                  <mat-option *ngFor="let plan of allPromoCodes" [value]="plan.code">
                    {{ plan.title }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="card__col-lg-6">
              <mat-form-field appearance="outline">
                <mat-label>Promo Code</mat-label>
                <input matInput placeholder="Promo Code" [(ngModel)]="selectedPromoCode" readonly>
              </mat-form-field>
            </div>

            <div class="card__col-lg-12" *ngIf="promoCodeInfo">
              <b style="font-size: 14px;">Promo code Information: </b><br>
              <div class="card__row">
                <div class="card__col-lg-5">
                  <span class="promo-head">Discount Type:</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'AMOUNT'">Discount:</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'AMOUNT'">Min Order:</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'PERCENTAGE'">Percentage:</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'PERCENTAGE'">Max Discount:</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'FIXED'">
                    <p *ngFor="let plan of promoCodeInfo.discountDetails">{{plan.name}}:</p>
                  </span>
                </div>
                <div class="card__col-lg-7" *ngIf="promoCodeInfo">
                  <span class="promo-head">{{promoCodeInfo.discountType}}</span><br>
                  <span class="promo-head"
                    *ngIf="promoCodeInfo.discountType === 'AMOUNT'">{{promoCodeInfo.discountAmount}}</span><br>
                  <span class="promo-head"
                    *ngIf="promoCodeInfo.discountType === 'AMOUNT'">{{promoCodeInfo.minOrderAmount}}</span><br>
                  <span class="promo-head"
                    *ngIf="promoCodeInfo.discountType === 'PERCENTAGE'">{{promoCodeInfo.discountPercent}}</span><br>
                  <span class="promo-head"
                    *ngIf="promoCodeInfo.discountType === 'PERCENTAGE'">{{promoCodeInfo.maxDiscountAmount}}</span><br>
                  <span class="promo-head" *ngIf="promoCodeInfo.discountType === 'FIXED'">
                    <p *ngFor="let plan of promoCodeInfo.discountDetails">{{plan.totalAmount}}</p>
                  </span>
                </div>
              </div>
            </div><br><br>

          </div>
          <div style="align-items: center; margin-top: 17px;">
            <button (click)="applyPromo()">Apply</button> &nbsp;
            <button (click)="removePromoCode()" type="reset">Remove</button>
          </div>
        </div>
      </div>

      <div class="card__col-lg-6">
        <mat-card>
          <b style="font-size: 18px;">Final Plan Pricing: </b><br>

          <div class="card__row">
            <div class="card__col-lg-5">

              <span class="head">Base Price:</span><br>
              <span class="head">cgst:</span><br>
              <span class="head">sgst:</span><br>
              <span class="head">igst:</span><br><br>
              <span class="head" *ngIf="this.userSubscription && this.userSubscription.promoCode"><b>Promo code
                  Discount:</b></span><br><br>
              <span class="head">Total Tax:</span><br><br>
              <span class="head"><b>Total Amount:</b></span>
            </div>
            <div class="card__col-lg-7">
              <span class="head">{{this.finalPricing['basePrice'] | currency:'INR'}}</span><br>
              <span class="head">{{this.finalPricing['cgst'] | currency:'INR'}}</span><br>
              <span class="head">{{this.finalPricing['sgst'] | currency:'INR'}}</span><br>
              <span class="head">{{this.finalPricing['igst'] | currency:'INR'}}</span><br><br>
              <span class="head" *ngIf="this.userSubscription && this.userSubscription.promoCode"><b>
                  {{getExactPromoDiscount() |
                  currency:'INR'}}
                </b></span><br><br>
              <span class="head">{{this.finalPricing['totalTax'] | currency:'INR'}}</span><br><br>
              <span class="head"><b>{{this.finalPricing['totalAmount'] |
                  currency:'INR'}}</b></span>
            </div>
          </div>
        </mat-card>
      </div>
    </div>
    <div class="card__row">
      <mat-card>
        <div class="card__row">
          <div class="card__col-lg-6">
            <mat-form-field appearance="outline">
              <mat-label>Start Date</mat-label>
              <input matInput placeholder="Start Date" [formControl]="subStartDate"
                (dateChange)="applyEndDateValidation($event.value)" [matDatepicker]="picker" autocomplete="off"
                required>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <!-- <mat-error
                      *ngIf="itrSummaryForm['controls'].assesse['controls'].family.controls[i].controls['dateOfBirth'].hasError('required')">
                      Select Date of
                      Birth</mat-error> -->
            </mat-form-field>
          </div>

          <div class="card__col-lg-6">
            <mat-form-field appearance="outline">
              <mat-label>End Date</mat-label>
              <input matInput placeholder="End Date" [max]="maxEndDate" [min]="minEndDate" [formControl]="subEndDate"
                [matDatepicker]="picker2" autocomplete="off" required>
              <!--[max]="EmaxDate"-->
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
              <!-- <mat-error
                      *ngIf="itrSummaryForm['controls'].assesse['controls'].family.controls[i].controls['dateOfBirth'].hasError('required')">
                      Select Date of
                      Birth</mat-error> -->
            </mat-form-field>
          </div>
        </div>
      </mat-card>
    </div>
    <div>
      <button class="btn act-btn" (click)="updateSubscription('')">Save</button>
      <button class="btn act-btn" (click)="updateSubscription('ACTIVATE')">Save & Activate</button>
    </div>
  </div>
</div>