<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"
></ngx-loading>
<div class="main clearfix" style="padding-top: 0px">
  <div class="card" *ngIf="page.addClient">
    <!-- <div class="content"> -->
    <button
      style="border: none"
      routerLink="/pages/itr-filing/customer-profile"
    >
      <i class="fa fa-arrow-left" aria-hidden="true"></i>
    </button>
    <b class="headline">Add Client</b>
    <span class="user-name"
      >({{ personalInfo.fName }} {{ personalInfo.lName }})</span
    ><br /><br /><br />

    <form [formGroup]="addClientForm">
      <div class="card__row">
        <div class="card__col-xs-12 card__col-sm-4">
          <mat-form-field appearance="outline">
            <mat-label>PAN Number</mat-label>
            <input
              [style.cursor]="
                ITR_JSON.eFillingCompleted == true ? 'not-allowed' : ''
              "
              [disabled]="ITR_JSON.eFillingCompleted === true"
              matTooltip="Format should like this(e.g. XXXXXNNNNX) X indicate character and N indicates number."
              matTooltipClass="tab-tooltip"
              matTooltipPosition="above"
              matInput
              placeholder="PAN"
              name="panNumber"
              formControlName="panNumber"
              class="input-field"
              maxlength="10"
              minlength="10"
              (blur)="setOtpValidation()"
              (keyup)="setUpperCase()"
              required
            />
            <mat-error
              *ngIf="addClientForm.controls['panNumber'].hasError('pattern')"
            >
              Enter valid PAN (e.g XXXXX1234X)</mat-error
            >
          </mat-form-field>
        </div>

        <div class="card__col-xs-12 card__col-sm-4">
          <mat-form-field appearance="outline">
            <mat-label>Date Of Birth</mat-label>
            <input
              matTooltip="Date of birth as per PAN"
              matTooltipClass="tab-tooltip"
              matTooltipPosition="above"
              matInput
              [min]="minDate"
              [max]="maxDate"
              [matDatepicker]="picker"
              class="input-field"
              placeholder="Date of birth"
              name="dateOfBirth"
              [formControl]="addClientForm.controls['dateOfBirth']"
            />
            <mat-hint>Format: DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="card__col-xs-12 card__col-sm-4">
          <button
            *ngIf="addClientForm.controls.panNumber.valid"
            class="btn long-btn"
            style="border: none"
            (click)="verifyPan()"
          >
            Verify PAN
          </button>
        </div>

        <div
          class="card__col-xs-12 card__col-sm-4"
          *ngIf="addClientForm.controls.panNumber.valid && otpSend"
        >
          <mat-form-field appearance="outline">
            <mat-label>Verify OTP</mat-label>
            <input
              matTooltip="Verify OTP"
              matTooltipClass="tab-tooltip"
              matTooltipPosition="above"
              matInput
              currencyMask
              placeholder="Verify OTP"
              name="otp"
              formControlName="otp"
              class="input-field"
              maxlength="75"
            />
            <mat-error
              *ngIf="addClientForm.controls['otp'].hasError('required')"
            >
              Enter OTP</mat-error
            >
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-4" *ngIf="otpSend">
          <button
            class="btn long-btn"
            style="border: none"
            (click)="verifyOtp()"
          >
            Verify OTP
          </button>
        </div>
        <div class="card__col-xs-12 card__col-sm-4" *ngIf="addClientForm.valid">
          <button
            class="btn long-btn"
            style="border: none"
            (click)="changePage()"
          >
            Next
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="card" *ngIf="page.directUpload">
    <button style="border: none" (click)="changePage()">
      <i class="fa fa-arrow-left" aria-hidden="true"></i>
    </button>
    <b class="headline">Direct Upload</b><br /><br />
    <div class="row">
      <input
        type="file"
        id="input-file-id"
        hidden
        file-model="MeterFile"
        class="inptfile"
        (change)="uploadFile($event.target.files)"
      />
      <button mat-raised-button (click)="upload()">
        <mat-icon>attachment</mat-icon> Select JSON File</button
      >&nbsp;&nbsp; <label *ngIf="uploadDoc">{{ uploadDoc.name }}</label
      >&nbsp;

      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="uploadDocument(uploadDoc)"
        [disabled]="!uploadDoc"
      >
        <mat-icon>upload</mat-icon> Validate JSON
      </button>
    </div>
    <br /><br />

    <button
      *ngIf="isValidateJson"
      style="float: right"
      class="btn long-btn"
      (click)="submit()"
    >
      Submit
    </button>
    <br /><br /><br /><br /><br />
    <div class="successRes" *ngIf="validateJsonResponse">
      <b
        >Congratulations! {{ personalInfo.fName }}'s I-T return is successfully
        filed through TaxBuddy.com.</b
      ><br />
      <ul>
        <li>These are your e-filling details:</li>
        <li><b>Name: </b> {{ personalInfo.fName }} {{ personalInfo.lName }}</li>
        <li><b>Phone No: </b> {{ ITR_JSON.contactNumber }}</li>
        <li><b>Assessment Year: </b> {{ ITR_JSON.assessmentYear }}</li>
        <li><b>Financial Year: </b> {{ ITR_JSON.financialYear }}</li>
        <li><b>ITR Form Type: </b> {{ ITR_JSON.itrType }}</li>
        <!-- <li><b>Return Type: </b> {{ITR_JSON.assessmentYear}}</li> -->
        <li><b>PAN: </b> {{ ITR_JSON.panNumber }}</li>
        <li>
          <b>Acknowledgement No: </b> {{ validateJsonResponse.arnNumber }}
        </li>
      </ul>
    </div>

    <br /><br />
  </div>
</div>
