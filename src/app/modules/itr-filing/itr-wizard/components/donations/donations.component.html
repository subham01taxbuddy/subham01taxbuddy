<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"
></ngx-loading>

<form [formGroup]="generalDonationForm">
  <div formArrayName="donationArray">
    <div
      class="display-flex"
      *ngFor="
        let donation of getDonationArray.controls | paginate : config;
        let i = index
      "
      [formGroupName]="fieldGlobalIndex(i)"
    >
      <mat-checkbox
        color="primary"
        name="hasEdit[i]"
        formControlName="hasEdit"
        class="mv"
      >
      </mat-checkbox>
      <div class="row">
        <div class="col-sm-3">
          <mat-label>Donation Type*</mat-label>
          <mat-form-field appearance="outline">
            <mat-select
              (selectionChange)="displayTooltip(i); changed()"
              matTooltip="{{ donationToolTip }}"
              matTooltipClass="tab-tooltip"
              matTooltipPosition="above"
              placeholder="Type of donee"
              formControlName="schemeCode"
              name="schemeCode[i]"
              required
            >
              <mat-option
                *ngFor="let dropdown of otherDonationToDropdown"
                [value]="dropdown.value"
                matTooltip="{{ dropdown.label }}"
                matTooltipClass="tab-tooltip"
                matTooltipPosition="above"
              >
                {{ dropdown.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-sm-3">
          <mat-label>Transaction (Cash)</mat-label>
          <mat-form-field appearance="outline">
            <input
              formControlName="amountInCash"
              name="amountInCash[i]"
              matInput
              placeholder="Amount in Cash"
              name="amount"
              required
              class="input-field"
              maxlength="14"
              digitsOnly
            />
            <mat-error
              *ngIf="
                donation.get('amountInCash').hasError('pattern') &&
                (donation.get('amountInCash').touched ||
                  donation.get('amountInCash').dirty)
              "
            >
              Enter positive amount without decimal.</mat-error
            >
          </mat-form-field>
        </div>

        <div class="col-sm-3">
          <mat-label>Transaction (Online)</mat-label>
          <mat-form-field appearance="outline">
            <input
              formControlName="amountOtherThanCash"
              matInput
              placeholder="Amount Other Than Cash"
              name="amountOtherThanCash[i]"
              required
              class="input-field"
              maxlength="14"
              digitsOnly
            />
            <mat-error
              *ngIf="donation.get('amountOtherThanCash').hasError('pattern')"
            >
              Enter positive amount without decimal.</mat-error
            >
          </mat-form-field>
        </div>
        <div class="col-sm-3">
          <mat-label>Name of donee*</mat-label>
          <mat-form-field appearance="outline">
            <input
              formControlName="name"
              matInput
              placeholder="Name of donee"
              name="name[i]"
              class="input-field"
              maxlength="125"
              required
              type="text"
              trim
            />
            <mat-error *ngIf="donation.get('name').hasError('pattern')">
              Name should be character only</mat-error
            >
          </mat-form-field>
        </div>

        <div class="col-sm-3 spsTp">
          <mat-label>PAN No of Donee*</mat-label>
          <mat-form-field appearance="outline">
            <input
              matTooltip="Format should like this(e.g. XXXXXNNNNX) X indicate character and N indicates number"
              matTooltipClass="tab-tooltip"
              matTooltipPosition="above"
              formControlName="panNumber"
              matInput
              currencyMask
              placeholder="PAN of donee"
              name="panNumber[i]"
              class="input-field"
              (blur)="checkDoneePAN(i, donation)"
              maxlength="10"
              minlength="10"
              required
              type="text"
              trim
              upperCase
            />
            <mat-error *ngIf="donation.get('panNumber').hasError('pattern')">
              Enter valid PAN (e.g XXXXX1234X)</mat-error
            >
            <mat-error *ngIf="donation.get('panNumber').hasError('incorrect')">
              Donee PAN can't be same as user PAN.</mat-error
            >
          </mat-form-field>
          <mat-label> If PAN not present, use 'GGGGG0000G'</mat-label>
        </div>
        <div class="col-sm-3 spsTp">
          <mat-label>PIN Code of Donee*</mat-label>
          <mat-form-field appearance="outline">
            <input
              formControlName="pinCode"
              matInput
              currencyMask
              placeholder="PIN"
              name="pinCode[i]"
              class="input-field"
              maxlength="6"
              minlength="6"
              required
              type="text"
              trim
              digitsOnly
              (blur)="
                getData(fieldGlobalIndex(i), donation.get('pinCode').value)
              "
            />
            <mat-error
              *ngIf="
                donation.get('pinCode').hasError('pattern') ||
                donation.get('pinCode').hasError('minlength') ||
                donation.get('pinCode').hasError('maxlength')
              "
            >
              PIN should have 6 digits.</mat-error
            >
          </mat-form-field>
        </div>
        <div class="col-sm-3 spsTp">
          <mat-label>City of Donee*</mat-label>
          <mat-form-field appearance="outline">
            <input
              formControlName="city"
              matInput
              placeholder="City/Taluka/District"
              name="city[i]"
              class="input-field"
              maxlength="50"
              required
              type="text"
              trim
            />
            <mat-error *ngIf="donation.get('city').hasError('pattern')">
              Enter valid city name.</mat-error
            >
          </mat-form-field>
        </div>
        <div class="col-sm-3 spsTp">
          <mat-label>State of Donee*</mat-label>
          <mat-form-field appearance="outline">
            <mat-select
              placeholder="State"
              formControlName="state"
              name="state[i]"
              required
            >
              <mat-option>Select One</mat-option>
              <mat-option
                *ngFor="let state of stateDropdown; let i = index"
                [value]="state.stateCode"
              >
                {{ state.stateName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-sm-9 spsTp">
          <mat-label>Address*</mat-label>
          <mat-form-field appearance="outline">
            <textarea
              formControlName="address"
              name="address[i]"
              matInput
              currencyMask
              placeholder="Address"
              class="input-field"
              required
              type="text"
              trim
            ></textarea>
          </mat-form-field>
        </div>
      </div>
      <!-- Row Ends -->
    </div>

    <div class="row spsTp bdrTp">
      <div class="col-sm-3">
        <button
          type="submit"
          class="tbd-btn-secondary delBtn"
          (click)="deleteDonationArray()"
        >
          <i class="fa fa-trash" aria-hidden="true">&nbsp;</i>Delete
        </button>
      </div>
      <div class="col-sm-6">
        <table>
          <tr
            *ngFor="let item of getDonationArray.controls | paginate : config"
          ></tr>
        </table>
        <pagination-controls
          (pageChange)="pageChanged($event)"
        ></pagination-controls>
      </div>
    </div>
  </div>
</form>
