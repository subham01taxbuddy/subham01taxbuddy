<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"
></ngx-loading>

<form [formGroup]="assetsForm" class="scroll" style="padding: 0 40px">
  <!-- otherAssets details  -->
  <div>
    <div>
      <!-- otherAssets  -->
      <div>
        <div class="row cardClr">
          <div class="col-sm-4" style="margin:25px 0px">
            <mat-label>Sale Date/Date of Transfer</mat-label>
            <mat-form-field appearance="outline">
              <input
                matInput
                formControlName="sellDate"
                name="sellDate"
                [matDatepicker]="sellDate"
                placeholder="Sale Date/Date of Transfer"
                (dateChange)="
                  calculateGainType();
                  calMaxPurchaseDate(assetsForm.get('sellDate')?.value)
                "
                [min]="minDate"
                [max]="maxDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="sellDate"
              ></mat-datepicker-toggle>
              <mat-datepicker #sellDate></mat-datepicker>
            </mat-form-field>
          </div>
          <!-- buy-date  -->
          <div class="col-sm-4" style="margin:25px 0px">
            <mat-label> Buy Date / Date of Acquisition </mat-label>
            <mat-form-field appearance="outline">
              <input
                matInput
                formControlName="purchaseDate"
                name="purchaseDate"
                [matDatepicker]="purchaseDate"
                placeholder="Buy Date / Date of Acquisition"
                (dateChange)="getImprovementYears(); calculateGainType()"
                [max]="maxPurchaseDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="purchaseDate"
              ></mat-datepicker-toggle>
              <mat-datepicker #purchaseDate></mat-datepicker>
            </mat-form-field>
          </div>

          <!-- buy-value  -->
          <div class="col-sm-4" style="margin:25px 0px">
            <mat-label> Buy Value</mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="purchaseCost"
                placeholder="Buy Value"
                name="purchaseCost[i]"
                class="input-field"
                maxlength="14"
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                (blur)="calculateGainType()"
              />

              <!-- <mat-error
                *ngIf="
                  getOtherAssetsArray.controls['purchaseCost'].hasError(
                    'pattern'
                  )
                "
                >Enter valid amount.</mat-error
              > -->
            </mat-form-field>
          </div>

          <!-- indexed cost of acquisition  -->
          <div
            class="col-sm-4"
            *ngIf="assetsForm.controls['gainType'].value === 'LONG'"
          >
            <mat-label> Indexed cost of acquisition</mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="indexCostOfAcquisition"
                placeholder="Indexed cost of acquistion"
                name="indexCostOfAcquisition[i]"
                class="input-field"
                readonly
              />
            </mat-form-field>
          </div>

          <!-- sale-value  -->
          <div class="col-sm-4 spsTp">
            <mat-label>Sale Value</mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="sellValue"
                placeholder="Sell Value"
                name="sellValue"
                class="input-field"
                maxlength="14"
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                (blur)="calculateCg()"
              />

              <!-- <mat-error
                *ngIf="
                  OtherAsssetImprovementForm.controls['otherAssets'].controls[
                    i
                  ].controls['otherAssetsArray'].controls['sellValue'].hasError(
                    'pattern'
                  )
                "
                >Enter valid amount.</mat-error
              > -->
            </mat-form-field>
          </div>
          <!-- expenses  -->
          <div class="col-sm-4 spsTp">
            <mat-label>Expenses</mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="sellExpense"
                placeholder="Expenses"
                name="sellExpense"
                class="input-field"
                maxlength="14"
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                (blur)="calculateGainType()"
              />
              <!-- <mat-error
                *ngIf="
                  getOtherAssetsArray.controls['sellExpense'].hasError(
                    'pattern'
                  )
                "
                >Enter valid amount.</mat-error
              > -->
            </mat-form-field>
          </div>
          <!-- type-of-gain  -->
          <div class="col-sm-4 spsTp">
            <mat-label>Type of Gain </mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="gainType"
                placeholder="Type of Gain"
                name="gainType"
                class="input-field"
                maxlength="14"
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                readonly
              />
            </mat-form-field>
          </div>
          <!-- gain-amount  -->
          <div class="col-sm-4 spsTp">
            <mat-label>Gain Amount</mat-label>
            <mat-form-field class="input-field-width" appearance="outline">
              <input
                matInput
                digitsOnly
                formControlName="capitalGain"
                placeholder="capitalGain"
                name="capitalGain"
                class="input-field"
                maxlength="14"
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                readonly
              />
            </mat-form-field>
          </div>

          <hr class="linSps" />
          <!-- cost-of-improvement  -->
          <div formArrayName="improvementsArray">
            <!-- co-owner yes-no selection  -->
            <div class="row linSps">
              <div class="col-sm-9">
                <mat-label class="txStyls"
                  >Add details of cost of improvements?*</mat-label
                >
              </div>
              <div class="col-sm-3">
                <mat-radio-group [formControl]="isImprovement">
                  <mat-radio-button
                    [value]="true"
                    style="margin-left: 0px"
                    labelPosition="before"
                    >Yes </mat-radio-button
                  >&nbsp;&nbsp;&nbsp;
                  <mat-radio-button [value]="false" labelPosition="before"
                    >No</mat-radio-button
                  >
                </mat-radio-group>
              </div>
            </div>

            <div *ngIf="isImprovement.value">
              <!-- add more button -->
              <div>
                <button class="new-add" (click)="addImprovementsArray()">
                  <i class="fa fa-plus" aria-hidden="true"></i> Add More
                </button>
              </div>
              <div
                style="padding: 25px"
                class="card"
                *ngFor="
                  let improve of getImprovementsArray.controls;
                  let j = index
                "
                [formGroupName]="j"
              >
                <div>
                  <!-- form content-->
                  <div class="row">
                    <div class="custom-control custom-checkbox">
                      <input
                        class="checkbox checkbox-secondary rounded border-2 w-[18px] h-[18px] mb-[-6px]"
                        type="checkbox"
                        (click)="$event.stopPropagation()"
                        [checked]="selectedIndexes.includes(j)"
                        (click)="toggleSelectedIndex(j)"
                      />
                    </div>
                    <div class="col-sm-4 spsTp">
                      <mat-label>Year Of Improvement</mat-label>
                      <mat-form-field
                        class="input-field-width"
                        appearance="outline"
                      >
                        <mat-select
                          placeholder="Year of Improvement"
                          formControlName="financialYearOfImprovement"
                          (blur)="
                            calculateCoiIndexation(
                              this.assetsForm?.controls['gainType'].value
                            )
                          "
                          required
                        >
                          <mat-option
                            [value]="year"
                            *ngFor="let year of improvementYears"
                          >
                            {{ year }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-4 spsTp">
                      <mat-label>Cost of Improvement</mat-label>
                      <mat-form-field
                        class="input-field-width"
                        appearance="outline"
                      >
                        <input
                          matInput
                          digitsOnly
                          formControlName="costOfImprovement"
                          placeholder="Cost Of Improvement"
                          (blur)="
                            calculateCoiIndexation(
                              this.assetsForm?.controls['gainType'].value
                            )
                          "
                          class="input-field"
                          maxlength="14"
                          oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                        />
                      </mat-form-field>
                    </div>
                    <div class="col-sm-4 spsTp">
                      <mat-label>Cost of Improvement with Indexation</mat-label>
                      <mat-form-field
                        class="input-field-width"
                        appearance="outline"
                      >
                        <input
                          matInput
                          digitsOnly
                          formControlName="indexCostOfImprovement"
                          placeholder="Cost Of Improvement with Indexation"
                          class="input-field"
                          maxlength="14"
                          oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                          readonly
                        />
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </div>

              <!-- // delete button -->
              <div style="margin-left: 5%">
                <button class="delete-btn" (click)="deleteImprovementsArray()">
                  <i class="fa fa-trash fa-lg" aria-hidden="true"></i> Delete
                </button>
              </div>
            </div>
          </div>
          <!-- cost-of-improvement Ends -->
        </div>
        <!-- Row Ends -->
      </div>
    </div>

    <div class="row spsTp bdrTp">
      <!--      <div class="col-sm-3">-->
      <!--        <button-->
      <!--          type="submit"-->
      <!--          class="delete-btn"-->
      <!--          (click)="deleteOtherAsset(index)"-->
      <!--          [disabled]="!assetSelected()"-->
      <!--        >-->
      <!--          <i class="fa fa-trash" aria-hidden="true">&nbsp;</i>Delete-->
      <!--        </button>-->
      <!--      </div>-->
      <div class="col-sm-6"></div>
      <div class="col-sm-3">
        <button class="tbd-btn save-btn mvRth" (click)="saveCg()">Save</button>
      </div>
    </div>
  </div>
</form>
