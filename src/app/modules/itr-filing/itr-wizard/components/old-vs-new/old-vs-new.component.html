<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"
></ngx-loading>

<div class="spc-blw">
  <div class="com_model perBx">
    <div class="container card">
      <div class="card__title" style="padding: 10px; font-size: 20px">
        Comparison of New v/s Old Regime
      </div>
      <div class="cardRect">
        <table class="table table-bordered">
          <thead style="background: #eaeaea">
            <tr class="table-head">
              <th class="text-center particular-label">Particulars</th>
              <th class="text-center particular-value">Old Tax Regime (₹)</th>
              <th class="text-center particular-value">New Tax Regime (₹)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let particular of particularsArray; let i = index">
              <td class="particular-label">
                {{ particular.label }}
              </td>
              <td class="particular-value">
                {{ particular.old }}
              </td>
              <td class="particular-value">
                {{ particular.new }}
              </td>
            </tr>
          </tbody>
        </table>

        <hr />

        <form [formGroup]="regimeSelectionForm" (ngSubmit)="gotoSummary()">
          <div class="card__row flex flex-col">
            <div
              class="card__col-xs-12 question-label"
              style="margin-bottom: 10px; background: #eaeaea"
            >
              <strong> Tax Regime Selection </strong>
              <mat-label> Select the best suited Tax Regime </mat-label>
            </div>

            <div
              formGroupName="optionForCurrentAY"
              *ngIf="
                this.ITR_JSON.itrType === '1' || this.ITR_JSON.itrType === '2'
              "
            >
              <div class="card__row">
                <div class="card__col-xs-9 question-label">
                  1. Are you opting for New Tax Regime?
                </div>
                <div
                  class="card__col-lg-2 card__col-md-2 card__col-sm-2 card__col-xm-2 text-right"
                >
                  <mat-radio-group
                    name="currentYearRegime"
                    formControlName="currentYearRegime"
                  >
                    <mat-radio-button
                      [value]="'NEW'"
                      style="margin-left: 0px; margin-right: 2px"
                      labelPosition="before"
                    >
                      Yes
                    </mat-radio-button>
                    <mat-radio-button [value]="'OLD'" labelPosition="before">
                      No
                    </mat-radio-button>
                  </mat-radio-group>

                  <mat-error
                    *ngIf="
                      regimeSelectionForm.controls[
                        'optionForCurrentAY'
                      ].controls['currentYearRegime'].hasError('required') &&
                      submitted
                    "
                  >
                    Please select an option to continue
                  </mat-error>
                </div>
              </div>
              <hr />
            </div>

            <div
              formGroupName="everOptedNewRegime"
              *ngIf="
                this.ITR_JSON.itrType === '3' || this.ITR_JSON.itrType === '4'
              "
            >
              <div class="card__row">
                <div class="card__col-xs-9 question-label">
                  1. Have you ever opted for New Regimes in earlier Years
                </div>
                <div
                  class="card__col-lg-2 card__col-md-2 card__col-sm-2 card__col-xm-2 text-right"
                >
                  <mat-radio-group
                    name="everOptedNewRegime"
                    formControlName="everOptedNewRegime"
                    (change)="updateRegimeLabels()"
                    required
                  >
                    <mat-radio-button
                      [value]="true"
                      style="margin-left: 0px; margin-right: 2px"
                      labelPosition="before"
                      >Yes
                    </mat-radio-button>
                    <mat-radio-button [value]="false" labelPosition="before"
                      >No</mat-radio-button
                    >
                  </mat-radio-group>
                  <mat-error
                    *ngIf="
                      regimeSelectionForm.controls[
                        'everOptedNewRegime'
                      ].controls['everOptedNewRegime'].hasError('required') &&
                      (this.ITR_JSON.itrType === '3' ||
                        this.ITR_JSON.itrType === '4') &&
                      submitted
                    "
                  >
                    Please select an option to continue
                  </mat-error>
                </div>
              </div>
              <div
                class="card__row"
                *ngIf="
                  regimeSelectionForm.controls['everOptedNewRegime'].controls[
                    'everOptedNewRegime'
                  ].value === true
                "
              >
                <div class="card__col-xs-4">
                  <mat-label class="option-label"
                    >Select Assessment Year :</mat-label
                  >
                  <mat-form-field appearance="outline">
                    <mat-select
                      placeholder="Select Assesment Year"
                      required
                      name="assessmentYear"
                      formControlName="assessmentYear"
                    >
                      <mat-option
                        *ngFor="let year of assesssmentYear"
                        [value]="year.assesssmentYear"
                      >
                        {{ year.assesssmentYear }}
                      </mat-option>
                    </mat-select>
                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedNewRegime'
                        ].controls['assessmentYear'].hasError('required') ||
                        submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!-- <mat-error *ngIf="changeStatus.controls['selectStatus.hasError('required')">Select status.</mat-error> -->
                  </mat-form-field>
                </div>
                <div class="card__col-xs-4">
                  <mat-label class="option-label"
                    >Acknowledgement Number</mat-label
                  >
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      maxlength="15"
                      minlength="15"
                      (blur)="setFilingDate()"
                      name="acknowledgementNumber"
                      formControlName="acknowledgementNumber"
                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      placeholder="Acknowledgement Number"
                      digitsOnly
                      onkeypress=" event.charCode >= 48 && event.charCode <= 57"
                      autocomplete="off"
                    />
                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedNewRegime'
                        ].controls['acknowledgementNumber'].hasError(
                          'required'
                        ) || submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('required')">-->
                    <!--                    Enter-->
                    <!--                    acknowledgement number</mat-error>-->
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('minlength')">-->
                    <!--                    Acknowledgement number should be 15 digit</mat-error>-->
                  </mat-form-field>
                </div>
                <div class="card__col-xs-4">
                  <mat-label class="option-label">Date:</mat-label>
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      placeholder="Date of filling"
                      [max]="fillingMaxDate"
                      readonly
                      name="date"
                      formControlName="date"
                      [matDatepicker]="picker1"
                      autocomplete="off"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker1"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedNewRegime'
                        ].controls['date'].hasError('required') || submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEDate'].hasError('required')">-->
                    <!--                    Select-->
                    <!--                    Date of-->
                    <!--                    filling</mat-error>-->
                  </mat-form-field>
                </div>
              </div>
              <hr />
            </div>

            <div
              formGroupName="everOptedOutOfNewRegime"
              *ngIf="
                this.ITR_JSON.itrType === '3' || this.ITR_JSON.itrType === '4'
              "
            >
              <div class="card__row">
                <div class="card__col-xs-9 question-label">
                  2. Have you ever opted out of New Regime in earlier Years
                </div>
                <div
                  class="card__col-lg-2 card__col-md-2 card__col-sm-2 card__col-xm-2 text-right"
                >
                  <mat-radio-group
                    name="everOptedOutOfNewRegime"
                    formControlName="everOptedOutOfNewRegime"
                    (change)="updateRegimeLabels()"
                    required
                  >
                    <mat-radio-button
                      [value]="true"
                      style="margin-left: 0px; margin-right: 2px"
                      labelPosition="before"
                      >Yes
                    </mat-radio-button>
                    <mat-radio-button [value]="false" labelPosition="before"
                      >No</mat-radio-button
                    >
                  </mat-radio-group>

                  <mat-error
                    *ngIf="
                      regimeSelectionForm.controls[
                        'everOptedOutOfNewRegime'
                      ].controls['everOptedOutOfNewRegime'].hasError(
                        'required'
                      ) && submitted
                    "
                  >
                    Please select an option to continue
                  </mat-error>
                </div>
              </div>
              <div
                class="card__row"
                *ngIf="
                  regimeSelectionForm.controls['everOptedOutOfNewRegime']
                    .controls['everOptedOutOfNewRegime'].value === true
                "
              >
                <div class="card__col-xs-4">
                  <mat-label class="option-label">
                    Select Assessment Year :
                  </mat-label>
                  <mat-form-field appearance="outline">
                    <mat-select
                      placeholder="Select Assesment Year"
                      required
                      name="assessmentYear"
                      formControlName="assessmentYear"
                    >
                      <mat-option
                        *ngFor="let year of assesssmentYear"
                        [value]="year.assesssmentYear"
                      >
                        {{ year.assesssmentYear }}
                      </mat-option>
                    </mat-select>

                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedOutOfNewRegime'
                        ].controls['assessmentYear'].hasError('required') ||
                        submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!-- <mat-error *ngIf="changeStatus.controls['selectStatus.hasError('required')">Select status.</mat-error> -->
                  </mat-form-field>
                </div>
                <div class="card__col-xs-4">
                  <mat-label class="option-label"
                    >Acknowledgement Number</mat-label
                  >
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      maxlength="15"
                      minlength="15"
                      (blur)="setFilingDate()"
                      name="acknowledgementNumber"
                      formControlName="acknowledgementNumber"
                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      placeholder="Acknowledgement Number"
                      digitsOnly
                      onkeypress=" event.charCode >= 48 && event.charCode <= 57"
                      autocomplete="off"
                    />

                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedOutOfNewRegime'
                        ].controls['acknowledgementNumber'].hasError(
                          'required'
                        ) || submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('required')">-->
                    <!--                    Enter-->
                    <!--                    acknowledgement number</mat-error>-->
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('minlength')">-->
                    <!--                    Acknowledgement number should be 15 digit</mat-error>-->
                  </mat-form-field>
                </div>
                <div class="card__col-xs-4">
                  <mat-label class="option-label">Date:</mat-label>
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      placeholder="Date of filling"
                      [max]="fillingMaxDate"
                      readonly
                      name="date"
                      formControlName="date"
                      [matDatepicker]="picker1"
                      autocomplete="off"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker1"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>

                    <mat-error
                      *ngIf="
                        regimeSelectionForm.controls[
                          'everOptedOutOfNewRegime'
                        ].controls['date'].hasError('required') || submitted
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEDate'].hasError('required')">-->
                    <!--                    Select-->
                    <!--                    Date of-->
                    <!--                    filling</mat-error>-->
                  </mat-form-field>
                </div>
              </div>
              <hr />
            </div>

            <div
              formGroupName="optionForCurrentAY"
              *ngIf="
                this.ITR_JSON.itrType === '3' || this.ITR_JSON.itrType === '4'
              "
            >
              <div class="card__row">
                <div class="card__col-xs-9 question-label">
                  3. Option for current Assessment year
                </div>
                <div
                  class="card__col-lg-2 card__col-md-2 card__col-sm-2 card__col-xm-2 text-right"
                >
                  <mat-radio-group
                    name="currentYearRegime"
                    formControlName="currentYearRegime"
                    (change)="updateCurrentAYOptions()"
                  >
                    <mat-radio-button
                      [value]="'NEW'"
                      style="margin-left: 0px; margin-right: 2px"
                      labelPosition="before"
                      >{{ newRegimeLabel }}
                    </mat-radio-button>
                    <mat-radio-button [value]="'OLD'" labelPosition="before">{{
                      oldRegimeLabel
                    }}</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    *ngIf="
                      regimeSelectionForm.controls[
                        'optionForCurrentAY'
                      ].controls['currentYearRegime'].hasError('required') &&
                      submitted
                    "
                  >
                    Please select an option to continue
                  </mat-error>
                </div>
              </div>
              <div class="card__row" *ngIf="showCurrentAYOptions">
                <div class="card__col-xs-4">
                  <mat-label class="option-label"
                    >Acknowledgement Number</mat-label
                  >
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      maxlength="15"
                      minlength="15"
                      (blur)="setFilingDate()"
                      name="acknowledgementNumber"
                      formControlName="acknowledgementNumber"
                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      placeholder="Acknowledgement Number"
                      digitsOnly
                      onkeypress=" event.charCode >= 48 && event.charCode <= 57"
                      autocomplete="off"
                    />

                    <mat-error
                      *ngIf="
                        this.ITR_JSON.itrType === '3' ||
                        this.ITR_JSON.itrType === '4' ||
                        showCurrentAYOptions
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('required')">-->
                    <!--                    Enter-->
                    <!--                    acknowledgement number</mat-error>-->
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('minlength')">-->
                    <!--                    Acknowledgement number should be 15 digit</mat-error>-->
                  </mat-form-field>
                </div>
                <div class="card__col-xs-4">
                  <mat-label class="option-label">Date:</mat-label>
                  <mat-form-field appearance="outline">
                    <input
                      matInput
                      placeholder="Date of filling"
                      [max]="fillingMaxDate"
                      readonly
                      name="date"
                      formControlName="date"
                      [matDatepicker]="picker1"
                      autocomplete="off"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker1"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                    <mat-error
                      *ngIf="
                        this.itrType === '3' ||
                        this.itrType === '4' ||
                        showCurrentAYOptions
                      "
                    >
                      This field is required
                    </mat-error>
                    <!--                <mat-error *ngIf="customerProfileForm.controls['form10IEDate'].hasError('required')">-->
                    <!--                    Select-->
                    <!--                    Date of-->
                    <!--                    filling</mat-error>-->
                  </mat-form-field>
                </div>
              </div>
              <hr />
            </div>
          </div>
        </form>

        <form [formGroup]="summaryToolReliefsForm">
          <div class="card__row flex flex-col">
            <div
              class="card__col-xs-12 question-label"
              style="margin-bottom: 10px; background: #eaeaea"
            >
              <strong> Summary Tool Fields </strong>
              <mat-label>Only Applicable if you have uploaded a Json</mat-label>
            </div>

            <!-- Section 89 -->
            <div class="flex items-center" style="margin-bottom: 10px">
              <div class="card__col-xs-9 question-label">1. Section 89</div>
              <div class="card__col-xs-3">
                <mat-label>Section 89</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="section89"
                    formControlName="section89"
                    placeholder="Relief under section89"
                    digitsOnly
                  />
                </mat-form-field>
              </div>
            </div>
            <div
              *ngIf="
                summaryToolReliefsForm.get('section89').value &&
                summaryToolReliefsForm.get('section89').value !== '0'
              "
              class="flex"
              style="margin-left: auto"
            >
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Number</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgement"
                    formControlName="acknowledgement89"
                    placeholder="Acknowledgement"
                    digitsOnly
                    required
                  />
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgement89')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Date</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgementDate"
                    formControlName="acknowledgementDate89"
                    placeholder="Acknowledgement Date"
                    required
                    [matDatepicker]="picker1"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker1"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgementDate89')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
            </div>
            <hr />

            <!-- section 90  -->
            <div class="flex items-center">
              <div class="card__col-xs-9 question-label">
                2. Section 90 / 90A
              </div>
              <div class="card__col-xs-3">
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="section90"
                    formControlName="section90"
                    placeholder="Relief under section90"
                    digitsOnly
                  />
                </mat-form-field>
              </div>
            </div>
            <div
              *ngIf="
                summaryToolReliefsForm.get('section90').value &&
                summaryToolReliefsForm.get('section90').value !== '0'
              "
              class="flex"
              style="margin-left: auto"
            >
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Number</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgement"
                    formControlName="acknowledgement90"
                    placeholder="Acknowledgement"
                    digitsOnly
                    required
                  />
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgement90')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Date</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgementDate"
                    formControlName="acknowledgementDate90"
                    placeholder="Acknowledgement Date"
                    required
                    [matDatepicker]="picker1"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker1"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgementDate90')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
            </div>
            <hr />

            <!-- section 91  -->
            <div class="flex items-center">
              <div class="card__col-xs-9 question-label">3. Section 91</div>
              <div class="card__col-xs-3">
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="section91"
                    formControlName="section91"
                    placeholder="Relief under section91"
                    digitsOnly
                  />
                </mat-form-field>
              </div>
            </div>
            <div
              *ngIf="
                summaryToolReliefsForm.get('section91').value &&
                summaryToolReliefsForm.get('section91').value !== '0'
              "
              class="flex"
              style="margin-left: auto"
            >
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Number</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgement"
                    formControlName="acknowledgement91"
                    placeholder="Acknowledgement"
                    digitsOnly
                    required
                  />
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgement91')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
              <div class="card__col-xs-6">
                <mat-label>Acknowledgement Date</mat-label>
                <mat-form-field appearance="outline">
                  <input
                    matInput
                    name="acknowledgementDate"
                    formControlName="acknowledgementDate91"
                    placeholder="Acknowledgement Date"
                    required
                    [matDatepicker]="picker1"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker1"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
                <mat-error
                  *ngIf="
                    summaryToolReliefsForm
                      .get('acknowledgementDate91')
                      .hasError('required')
                  "
                >
                  In order to claim relief, please enter the required fields
                </mat-error>
              </div>
            </div>
            <hr />
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="flex justify-between p-[30px] back-foot">
  <button (click)="goBack()" class="lgtBtn">Back to Sources</button>

  <button (click)="gotoSummary()" class="darkBtn">
    <span class="adjust">Save & Next</span>
    <i class="material-icons icoAd">arrow_right_alt </i>
  </button>
</div>
