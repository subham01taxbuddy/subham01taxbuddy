<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px',fullScreenBackdrop:true }"></ngx-loading>
<div class="card">

    <form [formGroup]="customerProfileForm">
        <div class="card__row card__col-xs-12">
            <div class="card__title card__col-xs-8 sub-heading">Address Details</div>
        </div>
        <div formGroupName="address">
            <div class="card__row">
                <div class="card__col-xs-12 card__col-sm-3">
                    <mat-label>PIN Code</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" matInput placeholder="PIN code" name="pinCode" formControlName="pinCode"
                            class="input-field" maxlength="6" minlength="6" trim digitsOnly required
                            (blur)="getCityData()">
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['pinCode'].hasError('required') || customerProfileForm.controls['address'].controls['pinCode'].hasError('pattern') || customerProfileForm.controls['address'].controls['pinCode'].hasError('minLength') || customerProfileForm.controls['address'].controls['pinCode'].hasError('maxLength')">
                            Enter
                            6 digit PIN code.</mat-error>
                    </mat-form-field>
                </div>
                <div class="card__col-xs-12 card__col-sm-3">
                    <mat-label>Select country</mat-label>
                    <mat-form-field appearance="outline">
                        <mat-select placeholder="Select country" name="country" formControlName="country"
                            (selectionChange)="changeCountry(customerProfileForm.controls['address'].controls['country'].value)"
                            required>
                            <mat-option *ngFor="let country of countryDropdown" [value]="country.countryCode">
                                {{ country.countryName | titlecase}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="card__col-xs-12 card__col-sm-3">
                    <mat-label>Select state</mat-label>
                    <mat-form-field appearance="outline">
                        <mat-select placeholder="Select state" name="state" formControlName="state" required>
                            <mat-option *ngFor="let state of stateDropdown" [value]="state.stateCode">
                                {{ state.stateName | titlecase}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="card__col-xs-12 card__col-sm-3">
                    <mat-label>City</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="City/Taluka/District" name="city"
                            formControlName="city" class="input-field" maxlength="50" required>
                        <mat-error *ngIf="customerProfileForm.controls['address'].controls['city'].hasError('pattern')">
                            Enter character
                            only.</mat-error>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['city'].hasError('required')">
                            Enter
                            city name.</mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div class="card__row">
                <div class="card__col-xs-12 card__col-sm-4">
                    <mat-label>Flat/Door/Block No.</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Flat/Door/Block No." name="flatNo"
                            formControlName="flatNo" class="input-field" maxlength="50" required>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['flatNo'].hasError('required')">
                            Enter
                            flat/door/block no.</mat-error>
                    </mat-form-field>
                </div>
                <div class="card__col-xs-12 card__col-sm-4">
                    <mat-label>Premises name</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Premises name" name="premisesName"
                            formControlName="premisesName" class="input-field" maxlength="50">
                    </mat-form-field>
                </div>
                <div class="card__col-xs-12 card__col-sm-4">
                    <mat-label>Area/ Locality</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Area/ Locality Characters Only" [pattern]="charRegex" name="area"
                            formControlName="area" class="input-field" maxlength="50" required>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['area'].hasError('required')">
                            Enter area/ Locality</mat-error>
                        <mat-error *ngIf="customerProfileForm.controls['address'].controls['area'].hasError('pattern')">
                            Enter character only</mat-error>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <hr>
        <div class="card__row card__col-xs-12">
            <div class="card__title sub-heading mt-2 card__col-xs-10">Bank Details</div>
            <div class="card__col-xs-2 txt-center">
                <button mat-icon-button color="warn" class="add-btn" (click)="addMoreBanks(this.customerProfileForm)"
                    [disabled]="!isEditPersonal">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i> Add Bank
                </button>
            </div>
        </div>
        <table class="table table-bordered" style="width: 100%;">
            <thead style="background:#eaeaea">
                <tr class="table-head" style="border-left: 1px solid #e0e0e0;border-right: 2px solid #f2f0f0;">
                    <th class="text-center">Delete</th>
                    <th class="text-center">IFSC Code*</th>
                    <th class="text-center">Name of Bank*</th>
                    <th class="text-center">Account Number*</th>
                    <th class="text-center">Refund Acc.*</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody formArrayName="bankDetails">
                <tr *ngFor="let bank of getBankDetailsArray.controls;let i=index" [formGroupName]="i">
                    <!-- <td> {{i+1}}</td> -->
                    <td style="padding-left: 15px;">
                        <mat-checkbox color="primary" name="hasEdit[i]" formControlName="hasEdit">
                        </mat-checkbox>
                    </td>
                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim upperCase matInput formControlName="ifsCode" placeholder=""
                                name="ifsCode[i]" class="input-field" maxlength="11" required
                                (blur)="getBankListByIfsc(customerProfileForm.controls['bankDetails'].controls[i].controls['ifsCode'],i)">
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['ifsCode'].hasError('pattern')">
                                Enter valid IFSC Code.</mat-error>
                        </mat-form-field>
                    </td>

                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim matInput formControlName="name" placeholder="" name="name[i]"
                                class="input-field" maxlength="125" required>
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['name'].hasError('pattern')">
                                Enter character only.</mat-error>
                        </mat-form-field>
                    </td>
                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim matInput formControlName="accountNumber" placeholder=""
                                name="accountNumber[i]" class="input-field" maxlength="20" minlength="3" digitsOnly
                                required>
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['accountNumber'].hasError('pattern') || customerProfileForm.controls['bankDetails'].controls[i].controls['accountNumber'].hasError('minlength')">
                                Account number should be between 3-20 digit</mat-error>
                        </mat-form-field>
                    </td>
                    <td style="padding-left: 15px;">
                        <mat-checkbox color="primary" name="hasRefund[i]" formControlName="hasRefund">
                        </mat-checkbox>
                    </td>

                    <td style="white-space: nowrap;padding: 0%;border:none;justify-content: center;">
                        <button mat-icon-button color="warn" class="table-add-remove-button text-left"
                            [disabled]="!customerProfileForm.controls['bankDetails'].controls[i].controls['hasEdit'].value"
                            (click)="deleteBank(i,this.customerProfileForm)">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
<!--        <hr>-->
<!--        <div class="card__title sub-heading mt-2">Tax Regime Selection</div>-->
<!--        <div class="card__row">-->
<!--            <div class="card__col-xs-12 card__col-sm-8" style="padding-top: 10px;">-->
<!--                Are you opting for New Tax Regime?-->
<!--            </div>-->
<!--            <div class="card__col-xs-12 card__col-sm-4"-->
<!--                matTooltip="{{customerProfileForm.controls['regime'].disabled? 'Due date is over' : null}}">-->
<!--                <mat-label>Select One</mat-label>-->
<!--                <mat-form-field appearance="outline">-->
<!--                    <mat-select name="regime" formControlName="regime" required (selectionChange)="onRegimeChanged()">-->
<!--                        <mat-option value="NEW"> Yes </mat-option>-->
<!--                        <mat-option value="OLD"> No </mat-option>-->
<!--                    </mat-select>-->
<!--                    <mat-error *ngIf="customerProfileForm.controls['regime'].disabled">-->
<!--                        Due date is over</mat-error>-->
<!--                </mat-form-field>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="card__row">-->
<!--            <div class="card__col-xs-12 card__col-sm-8" style="padding-top: 0px;">-->
<!--                Have you opted for new tax regime and filed form 10IE in the previous year?-->
<!--            </div>-->
<!--            <div class="card__col-xs-12 card__col-sm-4">-->
<!--                <mat-label>Select One</mat-label>-->
<!--                <mat-form-field appearance="outline">-->
<!--                    <mat-select name="previousYearRegime" formControlName="previousYearRegime"-->
<!--                        (selectionChange)="onRegimeChanged()">-->
<!--                        <mat-option value="NEW"> Yes </mat-option>-->
<!--                        <mat-option value="OLD"> No </mat-option>-->
<!--                    </mat-select>-->
<!--                    <mat-error *ngIf="customerProfileForm.controls['previousYearRegime'].hasError('required')">-->
<!--                        Select One</mat-error>-->
<!--                </mat-form-field>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="card__row" *ngIf="lastFilingDetailsNeeded" style="margin-top: 0;">-->
<!--            <div class="card__col-xs-12 card__col-sm-8 note mb-5">-->
<!--                Please furnish date of filing of form 10-IE along with Acknowledgement number-->
<!--            </div>-->
<!--            <div class="card__col-xs-12">-->
<!--                <div class="card__col-xs-12 card__col-sm-4" style="padding-top: 10px; padding-left: 0;">-->
<!--                    <mat-label>Acknowledgement Number</mat-label>-->
<!--                    <mat-form-field appearance="outline">-->
<!--                        <input matInput maxlength="15" minlength="15" (blur)="setFilingDate()"-->
<!--                            oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"-->
<!--                            disabled placeholder="Acknowledgement Number" digitsOnly formControlName="form10IEAckNo"-->
<!--                            onkeypress=" event.charCode >= 48 && event.charCode <= 57" autocomplete="off">-->
<!--                        <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('required')">-->
<!--                            Enter-->
<!--                            acknowledgement number</mat-error>-->
<!--                        <mat-error *ngIf="customerProfileForm.controls['form10IEAckNo'].hasError('minlength')">-->
<!--                            Acknowledgement number should be 15 digit</mat-error>-->
<!--                    </mat-form-field>-->
<!--                </div>-->
<!--                <div class="card__col-xs-12 card__col-sm-4" style="padding-top: 10px;">-->
<!--                    <mat-label>Date of filling</mat-label>-->
<!--                    <mat-form-field appearance="outline">-->
<!--                        <input matInput placeholder="Date of filling" [max]="fillingMaxDate" readonly-->
<!--                            [matDatepicker]="picker1" autocomplete="off" formControlName="form10IEDate">-->
<!--                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>-->
<!--                        <mat-datepicker #picker1></mat-datepicker>-->
<!--                        <mat-error *ngIf="customerProfileForm.controls['form10IEDate'].hasError('required')">-->
<!--                            Select-->
<!--                            Date of-->
<!--                            filling</mat-error>-->
<!--                    </mat-form-field>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

        <div class="footer__buttons clearfix">
            <button class="tbd-btn save-btn" [disabled]="!isEditPersonal && customerProfileForm.invalid"
                (click)="saveProfile('NEXT')">Save
            </button>
        </div>
    </form>
</div>
