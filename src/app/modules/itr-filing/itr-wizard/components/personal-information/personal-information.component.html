<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px',fullScreenBackdrop:true }"></ngx-loading>

    <form [formGroup]="customerProfileForm">
        <div class="col-sm-12">
            <div class="sub-heading">Address Details</div>
        </div>
        <div formGroupName="address">
            <div class="row">
                <div class="col-sm-3">
                    <mat-label>PIN Code</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" matInput placeholder="PIN code" name="pinCode" formControlName="pinCode"
                            class="input-field" maxlength="6" minlength="6" trim digitsOnly required
                            (blur)="getCityData()">
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['pinCode'].hasError('required') || customerProfileForm.controls['address'].controls['pinCode'].hasError('pattern') || customerProfileForm.controls['address'].controls['pinCode'].hasError('minLength') || customerProfileForm.controls['address'].controls['pinCode'].hasError('maxLength')">
                            Enter
                            6 digit PIN code.</mat-error>
                    </mat-form-field>
                </div>
                <div class="col-sm-3">
                    <mat-label>Select country</mat-label>
                    <mat-form-field appearance="outline">
                        <mat-select placeholder="Select country" name="country" formControlName="country"
                            (selectionChange)="changeCountry(customerProfileForm.controls['address'].controls['country'].value)"
                            required>
                            <mat-option *ngFor="let country of countryDropdown" [value]="country.countryCode">
                                {{ country.countryName | titlecase}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-sm-3">
                    <mat-label>Select state</mat-label>
                    <mat-form-field appearance="outline">
                        <mat-select placeholder="Select state" name="state" formControlName="state" required>
                            <mat-option *ngFor="let state of stateDropdown" [value]="state.stateCode">
                                {{ state.stateName | titlecase}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-sm-3">
                    <mat-label>City</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="City/Taluka/District" name="city"
                            formControlName="city" class="input-field" maxlength="50" required>
                        <mat-error *ngIf="customerProfileForm.controls['address'].controls['city'].hasError('pattern')">
                            Enter character
                            only.</mat-error>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['city'].hasError('required')">
                            Enter
                            city name.</mat-error>
                    </mat-form-field>
                </div>

                <div class="col-sm-4 spsTp">
                    <mat-label>Flat/Door/Block No.</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Flat/Door/Block No." name="flatNo"
                            formControlName="flatNo" class="input-field" maxlength="50" required>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['flatNo'].hasError('required')">
                            Enter
                            flat/door/block no.</mat-error>
                    </mat-form-field>
                </div>
                <div class="col-sm-4 spsTp">
                    <mat-label>Premises name</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Premises name" name="premisesName"
                            formControlName="premisesName" class="input-field" maxlength="50">
                    </mat-form-field>
                </div>
                <div class="col-sm-4 spsTp">
                    <mat-label>Area/Locality</mat-label>
                    <mat-form-field appearance="outline">
                        <input type="text" trim matInput placeholder="Area/ Locality Characters Only" [pattern]="charRegex" name="area"
                            formControlName="area" class="input-field" maxlength="50" required>
                        <mat-error
                            *ngIf="customerProfileForm.controls['address'].controls['area'].hasError('required')">
                            Enter area/ Locality</mat-error>
                        <mat-error *ngIf="customerProfileForm.controls['address'].controls['area'].hasError('pattern')">
                            Enter character only</mat-error>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <hr class="spsTp">
        <div class="col-sm-12">
            <div class="card__title sub-heading mt-2 card__col-xs-10">Bank Details</div>
            <div class="card__col-xs-2 txt-center">
                <button mat-icon-button color="warn" class="add-btn" (click)="addMoreBanks(this.customerProfileForm)"
                    [disabled]="!isEditPersonal">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i> Add Bank
                </button>
            </div>
        </div>
        <table class="table table-bordered" style="width: 100%;">
            <thead style="background:#eaeaea">
                <tr class="table-head" style="border-left: 1px solid #e0e0e0;border-right: 2px solid #f2f0f0;">
                    <th class="text-center">Delete</th>
                    <th class="text-center">IFSC Code*</th>
                    <th class="text-center">Name of Bank*</th>
                    <th class="text-center">Account Number*</th>
                    <th class="text-center">Refund Acc.*</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody formArrayName="bankDetails">
                <tr *ngFor="let bank of getBankDetailsArray.controls;let i=index" [formGroupName]="i">
                    <!-- <td> {{i+1}}</td> -->
                    <td style="padding-left: 15px;">
                        <mat-checkbox color="primary" name="hasEdit[i]" formControlName="hasEdit">
                        </mat-checkbox>
                    </td>
                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim upperCase matInput formControlName="ifsCode" placeholder=""
                                name="ifsCode[i]" class="input-field" maxlength="11" required
                                (blur)="getBankListByIfsc(customerProfileForm.controls['bankDetails'].controls[i].controls['ifsCode'],i)">
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['ifsCode'].hasError('pattern')">
                                Enter valid IFSC Code.</mat-error>
                        </mat-form-field>
                    </td>

                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim matInput formControlName="name" placeholder="" name="name[i]"
                                class="input-field" maxlength="125" required>
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['name'].hasError('pattern')">
                                Enter character only.</mat-error>
                        </mat-form-field>
                    </td>
                    <td>
                        <mat-form-field class="input-field-width" style="width: 90% !important;">
                            <input type="text" trim matInput formControlName="accountNumber" placeholder=""
                                name="accountNumber[i]" class="input-field" maxlength="20" minlength="3" digitsOnly
                                required>
                            <mat-error
                                *ngIf="customerProfileForm.controls['bankDetails'].controls[i].controls['accountNumber'].hasError('pattern') || customerProfileForm.controls['bankDetails'].controls[i].controls['accountNumber'].hasError('minlength')">
                                Account number should be between 3-20 digit</mat-error>
                        </mat-form-field>
                    </td>
                    <td style="padding-left: 15px;">
                        <mat-checkbox color="primary" name="hasRefund[i]" formControlName="hasRefund">
                        </mat-checkbox>
                    </td>

                    <td style="white-space: nowrap;padding: 0%;border:none;justify-content: center;">
                        <button mat-icon-button color="warn" class="table-add-remove-button text-left"
                            [disabled]="!customerProfileForm.controls['bankDetails'].controls[i].controls['hasEdit'].value"
                            (click)="deleteBank(i,this.customerProfileForm)">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="col-sm-12 spsTp bdrTp">
            <button class="tbd-btn save-btn mvRth" [disabled]="!isEditPersonal && customerProfileForm.invalid"
                (click)="saveProfile('NEXT')">Save
            </button>
        </div>


    </form>

