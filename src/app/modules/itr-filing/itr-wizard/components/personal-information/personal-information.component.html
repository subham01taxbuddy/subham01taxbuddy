<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"
></ngx-loading>

<form [formGroup]="customerProfileForm">
  <div class="col-sm-12">
    <div class="sub-heading">Address Details</div>
  </div>
  <div formGroupName="address">
    <div class="row">
      <div class="col-sm-3">
        <mat-label>PIN Code</mat-label>
        <mat-form-field appearance="outline">
          <input
            type="text"
            matInput
            placeholder="PIN code"
            name="pinCode"
            formControlName="pinCode"
            class="input-field"
            maxlength="6"
            minlength="6"
            trim
            digitsOnly
            required
            (blur)="getCityData()"
          />
          <mat-error
            *ngIf="
              addressForm.controls['pinCode'].hasError('required') ||
              addressForm.controls['pinCode'].hasError('pattern') ||
              addressForm.controls['pinCode'].hasError('minLength') ||
              addressForm.controls['pinCode'].hasError('maxLength')
            "
          >
            Enter 6 digit PIN code.</mat-error
          >
        </mat-form-field>
      </div>
      <div class="col-sm-3">
        <mat-label>Select country</mat-label>
        <mat-form-field appearance="outline">
          <mat-select
            placeholder="Select country"
            name="country"
            formControlName="country"
            (selectionChange)="
              changeCountry(addressForm.controls['country'].value)
            "
            required
          >
            <mat-option
              *ngFor="let country of countryDropdown"
              [value]="country.countryCode"
            >
              {{ country.countryName | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-sm-3">
        <mat-label>Select state</mat-label>
        <mat-form-field appearance="outline">
          <mat-select
            placeholder="Select state"
            name="state"
            formControlName="state"
            required
          >
            <mat-option
              *ngFor="let state of stateDropdown"
              [value]="state.stateCode"
            >
              {{ state.stateName | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-sm-3">
        <mat-label>City</mat-label>
        <mat-form-field appearance="outline">
          <input
            type="text"
            trim
            matInput
            placeholder="City/Taluka/District"
            name="city"
            formControlName="city"
            class="input-field"
            maxlength="50"
            required
          />
          <mat-error *ngIf="addressForm.controls['city'].hasError('pattern')">
            Enter character only.</mat-error
          >
          <mat-error *ngIf="addressForm.controls['city'].hasError('required')">
            Enter city name.</mat-error
          >
        </mat-form-field>
      </div>

      <div class="col-sm-4 spsTp">
        <mat-label>Flat/Door/Block No.</mat-label>
        <mat-form-field appearance="outline">
          <input
            type="text"
            trim
            matInput
            placeholder="Flat/Door/Block No."
            name="flatNo"
            formControlName="flatNo"
            class="input-field"
            maxlength="50"
            required
          />
          <mat-error
            *ngIf="addressForm.controls['flatNo'].hasError('required')"
          >
            Enter flat/door/block no.</mat-error
          >
        </mat-form-field>
      </div>
      <div class="col-sm-4 spsTp">
        <mat-label>Premises name</mat-label>
        <mat-form-field appearance="outline">
          <input
            type="text"
            trim
            matInput
            placeholder="Premises name"
            name="premisesName"
            formControlName="premisesName"
            class="input-field"
            maxlength="50"
          />
        </mat-form-field>
      </div>
      <div class="col-sm-4 spsTp">
        <mat-label>Area/Locality</mat-label>
        <mat-form-field appearance="outline">
          <input
            type="text"
            trim
            matInput
            placeholder="Area/ Locality Characters Only"
            [pattern]="charRegex"
            name="area"
            formControlName="area"
            class="input-field"
            maxlength="50"
            required
          />
          <mat-error *ngIf="addressForm.controls['area'].hasError('required')">
            Enter area/ Locality</mat-error
          >
          <mat-error *ngIf="addressForm.controls['area'].hasError('pattern')">
            Enter character only</mat-error
          >
        </mat-form-field>
      </div>
    </div>
  </div>
  <hr class="spsTp" />
  <div class="col-sm-12">
    <div class="card__title sub-heading mt-2 card__col-xs-10">Bank Details</div>
    <div class="card__col-xs-2 txt-center">
      <button
        mat-icon-button
        color="warn"
        class="add-btn"
        (click)="addMoreBanks(this.customerProfileForm)"
        [disabled]="!isEditPersonal"
      >
        <i class="fa fa-plus-circle" aria-hidden="true"></i> Add Bank
      </button>
    </div>
  </div>
  <table class="table table-bordered" style="width: 100%">
    <thead style="background: #eaeaea">
      <tr
        class="table-head"
        style="border-left: 1px solid #e0e0e0; border-right: 2px solid #f2f0f0"
      >
        <th class="text-center">Delete</th>
        <th class="text-center">IFSC Code*</th>
        <th class="text-center">Name of Bank*</th>
        <th class="text-center">Account Number*</th>
        <th class="text-center">Refund Acc.*</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody formArrayName="bankDetails">
      <tr
        *ngFor="let bank of getBankDetailsArray.controls; let i = index"
        [formGroupName]="i"
      >
        <!-- <td> {{i+1}}</td> -->
        <td style="padding-left: 15px">
          <mat-checkbox
            color="primary"
            name="hasEdit[i]"
            formControlName="hasEdit"
          >
          </mat-checkbox>
        </td>
        <td>
          <mat-form-field
            class="input-field-width"
            style="width: 90% !important"
          >
            <input
              type="text"
              trim
              upperCase
              matInput
              formControlName="ifsCode"
              placeholder=""
              name="ifsCode[i]"
              class="input-field"
              maxlength="11"
              required
              (blur)="getBankListByIfsc(bank.get('ifsCode'), i)"
            />
            <mat-error *ngIf="bank.get('ifsCode').hasError('pattern')">
              Enter valid IFSC Code.</mat-error
            >
          </mat-form-field>
        </td>

        <td>
          <mat-form-field
            class="input-field-width"
            style="width: 90% !important"
          >
            <input
              type="text"
              trim
              matInput
              formControlName="name"
              placeholder=""
              name="name[i]"
              class="input-field"
              maxlength="125"
              required
            />
            <mat-error *ngIf="bank.get('name').hasError('pattern')">
              Enter character only.</mat-error
            >
          </mat-form-field>
        </td>
        <td>
          <mat-form-field
            class="input-field-width"
            style="width: 90% !important"
          >
            <input
              type="text"
              trim
              matInput
              formControlName="accountNumber"
              placeholder=""
              name="accountNumber[i]"
              class="input-field"
              maxlength="20"
              minlength="3"
              digitsOnly
              required
            />
            <mat-error
              *ngIf="
                bank.get('accountNumber').hasError('pattern') ||
                bank.get('accountNumber').hasError('minlength')
              "
            >
              Account number should be between 3-20 digit</mat-error
            >
          </mat-form-field>
        </td>
        <td style="padding-left: 15px">
          <mat-checkbox
            color="primary"
            name="hasRefund[i]"
            formControlName="hasRefund"
          >
          </mat-checkbox>
        </td>

        <td
          style="
            white-space: nowrap;
            padding: 0%;
            border: none;
            justify-content: center;
          "
        >
          <button
            mat-icon-button
            color="warn"
            class="table-add-remove-button text-left"
            [disabled]="!bank.get('hasEdit').value"
            (click)="deleteBank(i, this.customerProfileForm)"
          >
            <i class="fa fa-trash" aria-hidden="true"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <hr class="spsTp" />
  <div formGroupName="seventhProviso139">
    <div>
      <div class="sub-heading">Filing Section</div>
    </div>

    <!--  Seventh provisio flag -->
    <div class="surround flex justify-between">
      <mat-label style="margin: 0px 75px 0px 15px" class="custom"
        >Are you filing return of income under Seventh proviso to section 139(1)
        but otherwise not required to furnish return of income?</mat-label
      >
      <mat-radio-group
        name="seventhProvisio139[i]"
        formControlName="seventhProvisio139"
        (change)="seventhProvisio139()"
      >
        <mat-radio-button
          [value]="'Y'"
          style="margin-left: 0px; margin-right: 2px"
          labelPosition="before"
        >
          Yes
        </mat-radio-button>
        <mat-radio-button [value]="'N'" labelPosition="before">
          No
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div
      *ngIf="seventhProviso139.controls['seventhProvisio139']?.value === 'Y'"
    >
      <!-- 1 -->
      <div class="surround radio-group-container">
        <mat-label style="margin: 15px 15% 15px 25px" class="custom"
          >Has incurred expenditure of an amount or aggregate of the amounts
          exceeding 2 lakh rupees for himself or any other person for travel to
          a foreign country
        </mat-label>
        <div class="flex" style="flex-direction: column">
          <div>
            <mat-radio-group
              name="strIncrExpAggAmt2LkTrvFrgnCntryFlg[i]"
              formControlName="strIncrExpAggAmt2LkTrvFrgnCntryFlg"
              (change)="strIncrExpAggAmt2LkTrvFrgnCntryFlg()"
            >
              <mat-radio-button
                [value]="'Y'"
                style="margin-left: 0px; margin-right: 2px"
                labelPosition="before"
              >
                Yes
              </mat-radio-button>
              <mat-radio-button [value]="'N'" labelPosition="before">
                No
              </mat-radio-button>
            </mat-radio-group>
          </div>
          <div
            *ngIf="
              seventhProviso139.controls['strIncrExpAggAmt2LkTrvFrgnCntryFlg']
                ?.value === 'Y'
            "
          >
            <div
              class="input-field-container"
              style="width: 75%; margin-top: 5px"
            >
              <mat-form-field appearance="outline" class="custom">
                <input
                  matInput
                  placeholder="Amount"
                  name="incrExpAggAmt2LkTrvFrgnCntryFlg[i]"
                  formControlName="incrExpAggAmt2LkTrvFrgnCntryFlg"
                />
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <!-- 2 -->
      <div class="surround radio-group-container">
        <mat-label style="margin: 15px 15% 15px 25px" class="custom"
          >Has incurred expenditure of an amount or aggregate of the amounts
          exceeding 1 lakh rupees towards consumption of electricity
        </mat-label>
        <div class="flex" style="flex-direction: column">
          <div>
            <mat-radio-group
              name="strIncrExpAggAmt1LkElctrctyPrYrFlg[i]"
              formControlName="strIncrExpAggAmt1LkElctrctyPrYrFlg"
              (change)="strIncrExpAggAmt1LkElctrctyPrYrFlg()"
            >
              <mat-radio-button
                [value]="'Y'"
                style="margin-left: 0px; margin-right: 2px"
                labelPosition="before"
              >
                Yes
              </mat-radio-button>
              <mat-radio-button [value]="'N'" labelPosition="before">
                No
              </mat-radio-button>
            </mat-radio-group>
          </div>
          <div
            *ngIf="
              seventhProviso139.controls['strIncrExpAggAmt1LkElctrctyPrYrFlg']
                ?.value === 'Y'
            "
          >
            <div
              class="input-field-container"
              style="width: 75%; margin-top: 5px"
            >
              <mat-form-field appearance="outline" class="custom">
                <input
                  matInput
                  placeholder="Amount"
                  name="incrExpAggAmt1LkElctrctyPrYrFlg[i]"
                  formControlName="incrExpAggAmt1LkElctrctyPrYrFlg"
                />
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <!-- 3 -->
      <div class="surround">
        <div class="radio-group-container">
          <mat-label style="margin: 15px 15% 15px 25px" class="custom">
            Fulfils such other conditions as may be prescribed under Rule 12AB
          </mat-label>
          <mat-radio-group
            name="clauseiv7provisio139i[i]"
            formControlName="clauseiv7provisio139i"
            (change)="clauseiv7provisio139i()"
          >
            <mat-radio-button
              [value]="'Y'"
              style="margin-left: 0px; margin-right: 2px"
              labelPosition="before"
            >
              Yes
            </mat-radio-button>
            <mat-radio-button [value]="'N'" labelPosition="before">
              No
            </mat-radio-button>
          </mat-radio-group>
        </div>
        <!-- 3 details -->
        <div
          class="surround"
          *ngIf="
            seventhProviso139.controls['clauseiv7provisio139i']?.value === 'Y'
          "
        >
          <div formArrayName="clauseiv7provisio139iDtls">
            <div class="flex justify-content-end" style="margin-right: 17%">
              <button
                mat-icon-button
                color="warn"
                class="add-btn"
                (click)="addClauseIv('addEmpty')"
              >
                <i class="fa fa-plus-circle" aria-hidden="true"></i> Add Bank
              </button>
            </div>
            <div
              *ngFor="
                let bank of getClauseiv7provisio139iDtls?.controls;
                let i = index
              "
              [formGroupName]="fieldGlobalIndex(i)"
            >
              <div
                class="flex"
                style="
                  margin: 15px 0px 15px 25px;
                  flex-direction: row;
                  align-items: center;
                  justify-content: flex-start;
                  gap: 10px;
                "
              >
                <mat-checkbox
                  color="primary"
                  name="hasEdit[i]"
                  formControlName="hasEdit"
                  class=""
                >
                </mat-checkbox>

                <div style="width: 75%">
                  <mat-form-field appearance="outline">
                    <mat-label>Nature*</mat-label>
                    <mat-select
                      placeholder="Nature"
                      name="nature[i]"
                      formControlName="nature"
                    >
                      <mat-option
                        *ngFor="
                          let clauseiv7provisio139iDtls of clauseiv7provisio139iDtlsList
                        "
                        [value]="clauseiv7provisio139iDtls.value"
                        matTooltip="{{ clauseiv7provisio139iDtls.nature }}"
                      >
                        {{ clauseiv7provisio139iDtls.nature }}
                      </mat-option></mat-select
                    >
                  </mat-form-field>
                </div>

                <div>
                  <mat-form-field appearance="outline">
                    <mat-label>Amount*</mat-label>
                    <input
                      matInput
                      placeholder="Amount"
                      name="amount[i]"
                      formControlName="amount"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <!-- delete button  -->
            <div class="row">
              <div class="col-sm-6" style="margin: 15px">
                <button
                  type="submit"
                  class="delete-btn"
                  (click)="deleteClauseIvArray()"
                >
                  <i class="fa fa-trash" aria-hidden="true">&nbsp;</i> Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 4 -->
      <div class="surround radio-group-container">
        <mat-label style="margin: 15px 15% 15px 25px" class="custom"
          >Has deposited an amount or aggregate of the amounts exceeding one
          crore rupees in one or more current accounts maintained with a banking
          company or a co-operative ban
        </mat-label>
        <div class="flex" style="flex-direction: column">
          <div>
            <mat-radio-group
              name="strDepAmtAggAmtExcd1CrPrYrFlg[i]"
              formControlName="strDepAmtAggAmtExcd1CrPrYrFlg"
              (change)="strDepAmtAggAmtExcd1CrPrYrFlg()"
            >
              <mat-radio-button
                [value]="'Y'"
                style="margin-left: 0px; margin-right: 2px"
                labelPosition="before"
              >
                Yes
              </mat-radio-button>
              <mat-radio-button [value]="'N'" labelPosition="before">
                No
              </mat-radio-button>
            </mat-radio-group>
          </div>
          <div
            *ngIf="
              seventhProviso139.controls['strDepAmtAggAmtExcd1CrPrYrFlg']
                ?.value === 'Y'
            "
          >
            <div
              class="input-field-container"
              style="width: 75%; margin-top: 5px"
            >
              <mat-form-field appearance="outline" class="custom">
                <input
                  matInput
                  placeholder="Amount"
                  name="depAmtAggAmtExcd1CrPrYrFlg[i]"
                  formControlName="depAmtAggAmtExcd1CrPrYrFlg"
                />
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <hr class="spsTp" />
  <div>
    <div class="sub-heading">Audit Information</div>
  </div>

  <!-- 44AA Liable question -->
  <div class="surround flex justify-between">
    <mat-label style="margin: 0px 75px 0px 15px" class="custom"
      >Are you filing return of income under Seventh proviso to section 139(1)
      but otherwise not required to furnish return of income?</mat-label
    >
    <mat-radio-group
      name="liableSection44AAflag[i]"
      formControlName="liableSection44AAflag"
    >
      <mat-radio-button
        [value]="'Y'"
        style="margin-left: 0px; margin-right: 2px"
        labelPosition="before"
      >
        Yes
      </mat-radio-button>
      <mat-radio-button [value]="'N'" labelPosition="before">
        No
      </mat-radio-button>
    </mat-radio-group>
  </div>

  <!-- <div class="col-sm-12 spsTp bdrTp">
            <button class="tbd-btn save-btn mvRth" [disabled]="!isEditPersonal && customerProfileForm.invalid"
                (click)="saveProfile('NEXT')">Save
            </button>
        </div> -->
</form>
