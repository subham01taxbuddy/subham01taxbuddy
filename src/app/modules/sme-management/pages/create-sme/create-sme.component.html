<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px', fullScreenBackdrop: true }"></ngx-loading>
<div class="main clearfix">
  <div class="card">
    <div class="card__row">
      <div class="card__col-xs-12 card__col-sm-3">
        <mat-form-field appearance="outline">
          <mat-label>Mobile Number</mat-label>
          <input matInput placeholder="Mobile Number" name="mobile" [formControl]="mobile" class="input-field"
            maxlength="10" type="mobile" required>
        </mat-form-field>
      </div>
      <div class="card__col-xs-12 card__col-sm-2">
        <button type="submit" class="tbd-btn" (click)="searchSme()">Search SME</button>
      </div>
      <div class="card__col-xs-12 card__col-sm-3" *ngIf="this.smeData" style="padding: 15px;
      font-size: 20px;
      text-align: center;">
        Name: {{this.smeData.firstName +' '+ this.smeData.lastName}}
      </div>
      <div class="card__col-xs-12 card__col-sm-3" *ngIf="this.smeData">
        <mat-form-field appearance="fill">
          <mat-label>User Role</mat-label>
          <mat-select [formControl]="userRole" multiple>
            <!--(selectionChange)="addValidationOnBtn()"-->
            <mat-select-trigger>
              {{userRole.value ? userRole.value : ''}}
              <!--   <span *ngIf="userRole.value?.length > 1" class="example-additional-selection">
                (+{{userRole.value.length - 1}} {{userRole.value?.length === 2 ? 'other'
                : 'others'}})
              </span> -->
            </mat-select-trigger>
            <mat-option *ngFor="let role of userRoleList" [value]="role.value" [disabled]="role.value === 'ROLE_USER'">
              {{role.label}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="card__col-xs-12 card__col-sm-1" *ngIf="this.smeData">
        <button type="submit" class="tbd-btn" (click)="updateUserRole()">Update</button>
      </div>
    </div>
  </div>
  <div class="card" *ngIf="showSmeDetails">
    <form [formGroup]="submitJsonForm">
      <div class="card__row">
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>SME Name</mat-label>
            <input matInput placeholder="Name" name="name" formControlName="name" class="input-field" maxlength="50"
              type="text" required>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>SME Email</mat-label>
            <input matInput placeholder="Email" name="email" formControlName="email" class="input-field" maxlength="50"
              type="email" required>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Mobile Number</mat-label>
            <input matInput placeholder="Mobile Number" name="mobileNumber" formControlName="mobileNumber"
              class="input-field" maxlength="10" type="mobile" required>
          </mat-form-field>
        </div>

        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Service Type</mat-label>
            <mat-select matInput formControlName="serviceType" placeholder="Select Service Type"
              (selectionChange)="changeServiceType()" required>
              <mat-option value="ITR"> ITR </mat-option>
              <mat-option value="GST"> GST </mat-option>
              <mat-option value="NOTICE"> Notice </mat-option>
              <mat-option value="TPA"> TPA </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="card__row">
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="fill">
            <mat-label>SME Languages</mat-label>
            <mat-select formControlName="languages" multiple>
              <mat-select-trigger>
                {{submitJsonForm.controls['languages'].value ? submitJsonForm.controls['languages'].value : ''}}
                <!--  <span *ngIf="submitJsonForm.controls['languages'].value?.length > 1"
                  class="example-additional-selection">
                  (+{{submitJsonForm.controls['languages'].value.length - 1}}
                  {{submitJsonForm.controls['languages'].value?.length === 2 ? 'other'
                  : 'others'}})
                </span> -->
              </mat-select-trigger>
              <mat-option *ngFor="let lang of langList" [value]="lang"> {{lang}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Bot Name</mat-label>
            <input matInput placeholder="Bot Name" name="botName" formControlName="botName" class="input-field"
              maxlength="50" type="text">
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Image URL</mat-label>
            <input matInput placeholder="Add S3 Image URL" name="imageUrl" formControlName="imageUrl"
              class="input-field" type="url">
            <mat-hint> Please add only s3 image url here</mat-hint>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Display Name</mat-label>
            <input matInput placeholder="Display Name" name="displayName" formControlName="displayName"
              class="input-field" maxlength="50" type="text" required>
          </mat-form-field>
        </div>

        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>SME Active Status</mat-label>
            <mat-select matInput formControlName="active" placeholder="Select Status" required>
              <mat-option [value]="trueVal"> Yes </mat-option>
              <mat-option [value]="falseVal"> No </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Joining Date</mat-label>
            <input matInput [matDatepicker]="joinPicker" [max]="maxJoinDate" class="input-field"
              placeholder="Joining Date" name="joiningDate" formControlName="joiningDate"
              (dateChange)="changeJoinDate(submitJsonForm.controls['joiningDate'].value)" required>
            <mat-hint>Format: DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="joinPicker"></mat-datepicker-toggle>
            <mat-datepicker #joinPicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Resigning Date</mat-label>
            <input matInput [matDatepicker]="resignPicker" [min]="minResignDate" [max]="maxResignDate"
              class="input-field" placeholder="Resigning Date" name="resigningDate" formControlName="resigningDate">
            <mat-hint>Format: DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="resignPicker"></mat-datepicker-toggle>
            <mat-datepicker #resignPicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Leave Start Date</mat-label>
            <input matInput [matDatepicker]="leaveSPicker" class="input-field" placeholder="Leave Start Date"
              name="leaveStartDate" formControlName="leaveStartDate">
            <mat-hint>Format: DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="leaveSPicker"></mat-datepicker-toggle>
            <mat-datepicker #leaveSPicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Leave End Date</mat-label>
            <input matInput [matDatepicker]="leaveEPicker" class="input-field" placeholder="Leave End Date"
              name="leaveEndDate" formControlName="leaveEndDate">
            <mat-hint>Format: DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="leaveEPicker"></mat-datepicker-toggle>
            <mat-datepicker #leaveEPicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3" *ngIf="submitJsonForm.controls['serviceType'].value === 'ITR'">
          <mat-form-field appearance="fill">
            <mat-label>Select ITR Types</mat-label>
            <mat-select formControlName="itrTypes" multiple>
              <mat-select-trigger>
                {{submitJsonForm.controls['itrTypes'].value ? submitJsonForm.controls['itrTypes'].value : ''}}
                <!--  <span *ngIf="submitJsonForm.controls['itrTypes'].value?.length > 1"
                  class="example-additional-selection">
                  (+{{submitJsonForm.controls['itrTypes'].value.length - 1}}
                  {{submitJsonForm.controls['itrTypes'].value?.length === 2 ? 'other'
                  : 'others'}})
                </span> -->
              </mat-select-trigger>
              <mat-option *ngFor="let itrType of itrTypeList" [value]="itrType.value"> {{itrType.display}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Internal User</mat-label>
            <mat-select matInput formControlName="internal" placeholder="Select User Type" required>
              <mat-option [value]="trueVal"> Yes </mat-option>
              <mat-option [value]="falseVal"> No </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Assignment Start</mat-label>
            <mat-select matInput formControlName="assignmentStart" placeholder="Assignment Start" required>
              <mat-option [value]="trueVal"> Yes </mat-option>
              <mat-option [value]="falseVal"> No </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="fill">
            <mat-label>Select Assessment Year</mat-label>
            <mat-select formControlName="assessmentYears" multiple>
              <mat-select-trigger>
                {{submitJsonForm.controls['assessmentYears'].value ? submitJsonForm.controls['assessmentYears'].value :
                ''}}
                <!--  <span *ngIf="submitJsonForm.controls['assessmentYears'].value?.length > 1"
                  class="example-additional-selection">
                  (+{{submitJsonForm.controls['assessmentYears'].value.length - 1}}
                  {{submitJsonForm.controls['assessmentYears'].value?.length === 2 ? 'other'
                  : 'others'}})
                </span> -->
              </mat-select-trigger>
              <mat-option value='2022-2023'> 2022-2023</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="card__col-xs-12 card__col-sm-3">
          <mat-form-field appearance="outline">
            <mat-label>Select Super Lead</mat-label>
            <mat-select matInput formControlName="parentId" placeholder="Select Super Lead">
              <mat-option *ngFor="let sl of parents" [value]="sl.userId"> {{sl.name}} </mat-option>
              <!-- <mat-option [value]="falseVal"> No </mat-option> -->
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <button type="submit" class="tbd-btn" (click)="updateSmeDetails()">Update SME</button>
    </form>
  </div>

</div>