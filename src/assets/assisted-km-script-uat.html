<!-- Add the below code in the km-script.html file.  -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 
</head>

<body>

    <script type="text/javascript">
        (function (d, m) {
            var data =JSON.parse(sessionStorage.getItem('LOGGED_IN_SME_INFO'));
            var userObj = data[0];
            var Obj = {
                apiDateTime: new Date(),
                serviceType: 'ITR',
                chatStatus: 'CHAT_LOAD_START',
                userId: userObj.userId
            }
            $.ajax({
                type: "POST",
                url: 'https://uat-api.taxbuddy.com/gateway/bot-logs',
                contentType: 'application/json',
                data: JSON.stringify(Obj),
                success: function (response) {
                    console.log('successfully called..', response)
                    // alert("Loaded");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // alert("Unable to save record, try after some time.");
                }
            });

            var defaultSettings = {
                'defaultBotIds': '3eb13dbd656feb3acdbdf650efbf437d1',
                "skipRouting": true
            }
            var kommunicateSettings = {
                "appId": "3eb13dbd656feb3acdbdf650efbf437d1",
                "userId": userObj['userId'],
                "onInit": function () {
                    var css = "#km-faq{display:none!important;}";
                    Kommunicate.customizeWidgetCss(css);
                    const userDetail = {
                        email: userObj['email'],
                        phoneNumber: userObj['mobileNumber'],
                        displayName: userObj['name'],
                        userId: userObj.userId,
                        password: '',
                        metadata: {
                            'userId': userObj.userId,
                            'contactNumber': userObj.mobileNumber,
                            'email': userObj['email'],
                            'Company Id': compId,
                            'Platform': 'Website'
                        }
                    };
                    Kommunicate.updateUser(userDetail);
                    Kommunicate.updateSettings(defaultSettings);
                    if (kmDetails !== null && kmDetails !== '' && kmDetails['conversationId'] !== null && kmDetails['conversationId'] !== ''
                        && kmDetails['conversationId'] !== undefined) {
                        console.log('Load Conversation using Group Id:', kmDetails['conversationId'])
                        Kommunicate.openConversation(kmDetails['conversationId']);
                    } else {
                        // var conversationDetail = {
                        //     // "defaultGroupName": kmDetails['email'], // Optional. To give a specific title to the conversation, replace "<DEFAULT_GROUP_NAME>" with the title you prefer. By default, the group title will be the name of the conversation assignee.
                        //     "agentIds": [kmDetails['email']], // Optional. If you do not pass any agent ID, the default agent will automatically get selected.
                        //     "botIds": [kmDetails['botId']], // Optional. Pass the bot IDs of the bots you want to add in this conversation.
                        //     "skipRouting": true, // Optional. If this parameter is set to 'true', then routing rules will be skipped for this conversation.
                        //     "assignee": kmDetails['email'] // Optional. You can assign this conversation to any agent or bot. If you do not pass the ID. the conversation will assigned to the default agent.
                        // };
                        Kommunicate.startConversation(defaultSettings, function (response) {
                            console.log("new conversation created");
                        });
                    }
                  
                }
            };
            var s = document.createElement("script"); s.type = "text/javascript"; s.async = true;
            s.src = "https://widget.kommunicate.io/v2/kommunicate.app";
            sessionStorage.setItem('KM_SCRIPT', "true");
            var h = document.getElementsByTagName("head")[0]; h.appendChild(s);
            window.kommunicate = m; m._globals = kommunicateSettings;
        })(document, window.kommunicate || {});
    </script>
</body>

</html>